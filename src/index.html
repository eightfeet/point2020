<!DOCTYPE html>
<html lang="zh">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Points</title>
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/default.min.css">
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js"></script>
    <script src="http://res.wx.qq.com/open/js/jweixin-1.6.0.js"></script>
    <script>
        function wechatAuth(data) {
            return fetch('https://yyj-test.by-health.com/scrm/wechatBH/jssdk', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded'
                },
                body: 'url=' + window.location.href + '&appId=wxdadf1deb1e480d13'
            }).then(res => {
                if (res.status !== 200) {
                    throw res;
                }
                return res.json();
            });
        }

        function initWechat() {
            wechatAuth().then(function (res) {
                var data = res;
                var url = window.location.href;
                window.wx.config({
                    debug: true, // 开启调试模式,调用的所有api的返回值会在客户端alert出来，若要查看传入的参数，可以在pc端打开，参数信息会通过log打出，仅在pc端时才会打印。
                    appId: data.appId, // 必填，公众号的唯一标识
                    timestamp: data.timestamp, // 必填，生成签名的时间戳
                    nonceStr: data.nonceStr, // 必填，生成签名的随机串
                    signature: data.signature,// 必填，签名
                    jsApiList: ['scanQRCode'] // 必填，需要使用的JS接口列表
                });
            }).catch(function (err) {
                console.log('微信授权失败', err);
                // document.getElementById('QrDom').style.display = 'none'
            });
        }
    </script>
    <style>
        em {
            font-style: italic;
            font-size: smaller;
        }

        .modaldemo_overlay, .by-health-points-message_overlay{
            position: fixed !important;
        }

        .menu {
            position: fixed;
            width: 300px;
            right: 0;
            top: 0;
            overflow-y:visible;
        }

        .menu a {
            text-decoration: none;
        }

        .main {
            margin-right: 350px;
        }
        .icon-demo {
            margin: 10px auto;
        }
        .icon-demo::before {
            content: '\2720';
            padding-right: 10px;
        }

        @media (max-width: 767px){ 
            .main {
                margin-right: 0;
            }
            .menu {
                position: relative;
                width: auto;
                overflow-y: auto;
            }
        }
    </style>
</head>

<body>
    <section>
        <header>
            <h1>Points 防伪积分模块</h1>
        </header>
        <article>
            <ul class="menu">
                <li><a href="#part1">快速开始</a></li>
                <li>
                    <a href="#part2">Parame 创建实例参数</a>
                    <ul>
                        <li><a href="#data">data</a></li>
                        <li><a href="#elementNodeMappingField">elementNodeMappingField</a></li>
                        <li><a href="#verifyPhone">verifyPhone</a></li>
                        <li><a href="#bindPhone">bindPhone</a></li>
                        <li><a href="#disabledPhone">disabledPhone</a></li>
                        <li><a href="#hidePhone">hidePhone</a></li>
                        <li><a href="#errorCodeMap">errorCodeMap</a></li>
                        <li><a href="#API">API</a></li>
                        <li><a href="#targetId">targetId</a></li>
                        <li><a href="#id">id</a></li>
                        <li><a href="#autoMount">autoMount</a></li>
                        <li><a href="#onScan">onScan</a></li>
                        <li><a href="#handleError">handleError</a></li>
                        <li><a href="#handleValidate">handleValidate</a></li>
                        <li><a href="#onInit">onInit</a></li>
                        <li><a href="#onSubmit">onSubmit</a></li>
                        <li><a href="#verifyPhoneCountdown">verifyPhoneCountdown</a></li>
                    </ul>
                </li>
                <li>
                    <a href="#part3">Options 实例属性</a>
                    <ul>
                        <li><a href="#setData">Points.setData</a></li>
                        <li><a href="#mount">Points.mount</a></li>
                        <li><a href="#$data">Points.$data</a></li>
                        <li><a href="#prevData">Points.prevData</a></li>
                    </ul>
                </li>
                <li>
                    <a href="#part4">static 静态属性</a>
                    <ul>
                        <li><a href="#PointsError">Points.PointsError</a></li>
                        <li><a href="#tools">Points.tools</a></li>
                    </ul>
                </li>
            </ul>
            <div class="main">
                <h2 id="part1">快速开始</h2>
                <p>HTML</p>
                <small>在应用页面中创建挂载DOM</small>
                <pre>
                    <code class="language-html">&lt;div id=&quot;targetId&quot;&gt;&lt;/div&gt;</code>
                </pre>
                <p>javaScript</p>
                <small>实例一个Points</small>
                <pre>
                    <code class="language-javascript">
    var pointsStart = new Points({
        targetId: 'targetId'
    });
                    </code>
                </pre>
                <p>Example</p>
                <div id="targetId" style="max-width: 400px;"></div>
                <br />
                <h2 id="part2">Parame 创建实例参数</h2>
                <p><b id="data">data</b> <em>Object</em> <em>非必填</em> <br /><span id="demo-" class="icon-demo">demo</span><br />初始化参数，参数将分发到各个接口（防伪积分，绑定手机，获取验证码）</p>
                <pre>
                    <code class="language-javascript">
    data: {
        phone: '13114876522', // 积分手机
        antiFakeCode: 'xxx...', // 16位产品防伪码
        openid: 'xxxx', // 微信openid，绑定手机时用到
        verificationCode: '2453', // 手机验证码，绑定手机或验证手机时用到
        ...其他参考中台api对应参数
    }
                    </code>
                </pre>
                <p>
                    <b id="elementNodeMappingField">elementNodeMappingField</b> 
                    <em>Object</em> 
                    <em>非必填</em> <br /><span id="demo-" class="icon-demo">demo</span><br />
                    自定义HTHLelement Id 与字段(表单/事件)的映射关系<br />
                    <em>
                        注意：定义此参数意味着用户将弃用Points创建的模板，
                        将使用自己页面的HTML元素托管Points的表单与事件，
                        请务必使用HTMLelement Id 作为映射值
                    </em>
                </p>
                <pre>
                    <code class="language-javascript">
    elementNodeMappingField: {
        phone: "电话号码输入框Id"
        verificationCode: "验证码输入框Id"
        antiFakeCode: "防伪码输入框Id"
        scan: "扫描防伪码按钮Id"
        sendVerificationCode: "发送验证码按钮Id"
        submit: "提交按钮Id"
    }
                    </code>
                </pre>

                <p>
                    <b id="verifyPhone">verifyPhone</b> 
                    <em>Boolean</em> 
                    <em>非必填</em> <br /><span id="demo-" class="icon-demo">demo</span><br />
                    是否验证手机号码 默认 false
                </p>
                <pre>
                    <code class="language-javascript">
    Points.verifyPhone = true
                    </code>
                </pre>

                <p>
                    <b id="bindPhone">bindPhone</b> 
                    <em>Boolean</em> 
                    <em>非必填</em> <br /><span id="demo-" class="icon-demo">demo</span><br />
                    是否绑定手机号码 默认 false<br />
                    <em>注意：当开启绑定手机号码时需要向绑定接口传openid参数，可在实例Points时通过data参数传入，也可以通过Points.setData({openid: 'xxx'})方法写入</em>
                </p>
                <pre>
                    <code class="language-javascript">
    Points.verifyPhone = true
                    </code>
                </pre>

                <p>
                    <b id="disabledPhone">disabledPhone</b> 
                    <em>Boolean</em> 
                    <em>非必填</em> <br /><span id="demo-" class="icon-demo">demo</span><br />
                    是否禁止输入/修改手机号码 默认 false，仅适用于非自定义模板，自定义模板需额外自行处理<br />
                </p>
                <pre>
                    <code class="language-javascript">
    Points.disabledPhone = true
                    </code>
                </pre>

                <p>
                    <b id="hidePhone">hidePhone</b> 
                    <em>Boolean</em> 
                    <em>非必填</em> <br /><span id="demo-" class="icon-demo">demo</span><br />
                    隐藏手机号码输入框 默认 false，仅适用于非自定义模板，自定义模板需额外自行处理<br />
                </p>
                <pre>
                    <code class="language-javascript">
    Points.disabledPhone = true
                    </code>
                </pre>

                <p>
                    <b id="errorCodeMap">errorCodeMap</b> 
                    <em>Object</em> 
                    <em>非必填</em> <br /><span id="demo-" class="icon-demo">demo</span><br />
                    自定义错误码与错误信息，用于复写接口返回code对应的message<br />
                </p>
                <pre>
                    <code class="language-javascript">
    Points.errorCodeMap = {
        404: '对不起！迷路了。',
        500: '服务器摔了一跤！',
        ...
    }
                    </code>
                </pre>

                <p>
                    <b id="API">API</b> 
                    <em>Object</em> 
                    <em>非必填</em> <br /><span id="demo-" class="icon-demo">demo</span><br />
                    定义防伪积分，绑定手机，获取验证码等 api接口 默认使用中台生产API（开发过程中也可用来替换测试环境API）<br />
                </p>
                <pre>
                    <code class="language-javascript">
    Points.API = {
        antifakecode: '积分防伪对应的接口', 
        bindPhone: '绑定手机对应的接口', 
        sendValidateCode: '获取验证码对应的接口', 
    }
                    </code>
                </pre>

                <p>
                    <b id="targetId">targetId</b> 
                    <em>String</em> 
                    <em>非必填</em> <br /><span id="demo-" class="icon-demo">demo</span><br />
                    使用默认模版时，默认模版挂载的目标HTHLelement Id （不填将挂载在body下）<br />
                </p>
                <pre>
                    <code class="language-javascript">
    Points.targetId = 'targetId'
                    </code>
                </pre>

                <p>
                    <b id="id">id</b> 
                    <em>String</em> 
                    <em>非必填</em> <br /><span id="demo-" class="icon-demo">demo</span><br />
                    模板id（不填时系统将默认创建一个）<br />
                </p>
                <pre>
                    <code class="language-javascript">
    Points.id = 'id'
                    </code>
                </pre>

                <p>
                    <b id="autoMount">autoMount</b> 
                    <em>Boolean</em> 
                    <em>非必填</em> <br /><span id="demo-" class="icon-demo">demo</span><br />
                    实例化Points时是否自动完成HTHLelement元素的挂载以及事件的处理，默认true；（false时需要通过Points.mount方法手动挂载）<br />
                </p>
                <pre>
                    <code class="language-javascript">
    Points.id = 'id'
                    </code>
                </pre>

                <p>
                    <b id="onInit">onInit</b> 
                    <em>Function</em> 
                    <em>非必填</em> <br /><span id="demo-" class="icon-demo">demo</span><br />
                    初始化回调<br />
                </p>
                <pre>
                    <code class="language-javascript">
    Points.onInit = function(){
        // 实例创建时调用
    }
                    </code>
                </pre>

                <p>
                    <b id="onScan">onScan</b> 
                    <em>Function</em> 
                    <em>非必填</em> <br /><span id="demo-" class="icon-demo">demo</span><br />
                    扫码回调<br />
                </p>
                <pre>
                    <code class="language-javascript">
    Points.onScan = function(code){
        // code: 防伪码
    }
                    </code>
                </pre>

                <p>
                    <b id="handleValidate">handleValidate</b> 
                    <em>Function</em> 
                    <em>非必填</em> <br /><span id="demo-" class="icon-demo">demo</span><br />
                    操作数据验证，用于追加验证逻辑处理，允许通过Promise来终止积分流程<br />
                </p>
                <pre>
                    <code class="language-javascript">
    Points.handleValidate = function(data){
        // data 提交的参数
        return new Promise(function(resolve, reject){
            if () {
                resolve()
            } else {
                reject(new Points.PointsError('出错了', 2009))
            }
        })
    }
                    </code>
                </pre>

                <p>
                    <b id="onSubmit">onSubmit</b> 
                    <em>Function</em> 
                    <em>非必填</em> <br /><span id="demo-" class="icon-demo">demo</span><br />
                    积分成功回调<br />
                </p>
                <pre>
                    <code class="language-javascript">
    Points.onSubmit = function(result){
        // result: 积分结果
    }
                    </code>
                </pre>

                <p>
                    <b id="handleError">handleError</b> 
                    <em>Function</em> 
                    <em>非必填</em> <br /><span id="demo-" class="icon-demo">demo</span><br />
                    处理积分异常，用于处理需要调整的异常结果，允许通过Promise来终止积分流程的异常结果处理<br />
                </p>
                <pre>
                    <code class="language-javascript">
    Points.handleError = function(error){
        // error: 错误信息
        return new Promise(function(resolve, reject){
            if () {
                // 需要干预的异常处理，
                // ...
            } else {
                throw error
            }
        })
    }
                    </code>
                </pre>

                <p>
                    <b id="verifyPhoneCountdown">verifyPhoneCountdown</b> 
                    <em>Object</em> 
                    <em>非必填</em> <br /><span id="demo-" class="icon-demo">demo</span><br />
                    获取手机验证码与倒计时设置<br />
                </p>
                <pre>
                    <code class="language-javascript">
    Points.verifyPhoneCountdown = {
        interval: '倒计时', 
        buttonText: '按钮文字', 
        countdownText: function(count){
            // 接受一个方法复写倒计时文字 
            return (count + '秒后重试')
        }
    }
                    </code>
                </pre>

                <h2 id="part3">Options 实例属性</h2>
                <p>
                    <b id="setData">Points.setData</b> 
                    <em>Function</em> 
                    <br /><br />
                    设置当前实例的data参数，这里做了对象的描述属性的代理，不能直接使用Points.data = {phone: '13665781168'}来定义data参数<br />
                </p>
                <pre>
                    <code class="language-javascript">
    Points.setData({
        phone: '13665781168'
    })
                    </code>
                </pre>

                <p>
                    <b id="mount">Points.mount</b> 
                    <em>Function</em> 
                    <br /><br />
                    将当前实例重新挂载、重置数据、绑定与事件、代理。<br />
                </p>
                <pre>
                    <code class="language-javascript">
    // targetId：重置将挂载的targetId 非必填 默认使用原始targetId, 
    // map：重置后的HTML id与字段的映射关系 非必填 默认使用原始映射关系
    Points.mount(targetId, map)
                    </code>
                </pre>

                <p id="$data">
                    <b>Points.$data</b> 
                    <em>Object</em> 
                    <br /><br />
                    获取当前实例参数<br />
                </p>
                <pre>
                    <code class="language-javascript">
    var parame = Points.$data;
                    </code>
                </pre>

                <p id="prevData">
                    <b>Points.prevData</b> 
                    <em>Object</em> 
                    <br /><br />
                    获取历史(请求\响应)数据 <br />
                </p>
                <pre>
                    <code class="language-javascript">
    var prevData = Points.prevData;
    prevData.request = '上次的查询数据';
    prevData.response = '上次的查询结果数据';
                    </code>
                </pre>

                <h2 id="part4">static 静态属性</h2>
                <p>
                    <b id="PointsError">Points.PointsError</b> 
                    <em>Class</em> 
                    <br /><br />
                    用于创建Points内部能处理的异常<br />
                </p>
                <pre>
                    <code class="language-javascript">
    // message错误信息 code错误码。
    throw new PointsError(message, code);

                    </code>
                </pre>

                <p>
                    <b id="tools">Points.tools</b> 
                    <br /><br />
                    其他工具集<br />
                </p>
                <pre>
                    <code class="language-javascript">
    Points.tools = {
        Modal, // Class 信息弹窗
        Loading, // Class 加载 Loading
        validate, // Object 表单验证工具
        nativeAppJssdk, // 营养管家AppJssdk
        // 整合微信与营养管家App的条形码与二维码扫码方法
        scan:{
            qrCode,
            barCode
        }
    }

                    </code>
                </pre>
            </div>
        </article>
        <footer> <small>By-health FED</small> </footer>
    </section>
</body>
<script>
    var Modal = ___Points___.tools.Modal;
    var demoModal = new Modal({
        id: 'modaldemo',
        style: {
            close: { 
                width: '20px',
                height: '20px',
                backgroundColor: 'red'
            },
            content: {
                borderRadius: '6px',
                width: '300px'
            }
        }
    });
    function showDemo(){
        demoModal.create({header: 'demo', article: '这是一个弹窗'})
        .then(() => console.log('弹窗已打开'));
    }
    
    var pointsStart = new ___Points___({
        targetId: 'targetId'
    });
</script>
<script>
    initWechat();
    document.querySelector('.menu').style.height = (window.innerHeight * .9) + 'px';
</script>
<script>
    hljs.initHighlightingOnLoad();
    document.addEventListener('DOMContentLoaded', (event) => {
        document.querySelectorAll('pre code').forEach((block) => {
            hljs.highlightBlock(block);
        });
    });
</script>

</html>